<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RelatedTopics.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">mvcdemo2</a> &gt; <a href="index.source.html" class="el_package">com.example.mvcdemo2.task</a> &gt; <span class="el_source">RelatedTopics.java</span></div><h1>RelatedTopics.java</h1><pre class="source lang-java linenums">package com.example.mvcdemo2.task;

//import com.alibaba.fastjson.JSON;
import com.example.mvcdemo2.model.Student;
import com.example.mvcdemo2.service.StudentService;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import jakarta.servlet.http.HttpServletRequest;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.*;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.stream.Collectors;

@Controller
public class RelatedTopics {

    private final StudentService studentService;
<span class="nc" id="L26">    public RelatedTopics(StudentService studentService) {</span>
<span class="nc" id="L27">        this.studentService = studentService;</span>
<span class="nc" id="L28">    }</span>
<span class="nc" id="L29">    private static final Logger LOGGER = LoggerFactory.getLogger(TopicPopularity.class);</span>

    @GetMapping(&quot;/searchTopics&quot;)
    @ResponseBody
    public String searchTopics(Model model, @RequestParam String keyword) {
        // 获取匹配的主题，这里假设有一个方法来获取匹配的主题，你可以根据实际情况实现
<span class="nc" id="L35">        String matchedWords = getMatchedWords(keyword);</span>
<span class="nc" id="L36">        LOGGER.info(&quot;Finding the related topic using:&quot;+keyword);</span>

        // 获取同义词并扩展搜索结果
        //List&lt;Student&gt; expandedWords = expandSearchWithSynonyms(matchedWords);

        //model.addAttribute(&quot;students&quot;, expandedWords);


<span class="nc" id="L44">        return matchedWords;</span>
    }

    @GetMapping(&quot;/showTopics&quot;)
    @ResponseBody
    public String shoeTopics(Model model, @RequestParam String keyword) {
        // 获取匹配的主题，这里假设有一个方法来获取匹配的主题，你可以根据实际情况实现
<span class="nc" id="L51">        String matchedWords = getMatchedTopic(keyword);</span>
<span class="nc" id="L52">        LOGGER.info(&quot;Finding the related topic using:&quot;+keyword);</span>

        // 获取同义词并扩展搜索结果
        //List&lt;Student&gt; expandedWords = expandSearchWithSynonyms(matchedWords);

        //model.addAttribute(&quot;students&quot;, expandedWords);


<span class="nc" id="L60">        return matchedWords;</span>
    }
    public String getMatchedTopic(String keyword) {
<span class="nc" id="L63">        System.out.println(keyword);</span>
<span class="nc" id="L64">        Map&lt;String, Integer&gt; wordFrequencyMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L65">        List&lt;Student&gt; students = studentService.getStudents();</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">        for (Student student : students) {</span>
<span class="nc" id="L67">            String tag = student.getTags();</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">            if (containsWord(tag, keyword)) {</span>
<span class="nc" id="L69">                tag = tag.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span class="nc" id="L70">                String[] sp = tag.split(&quot;,&quot;);</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">                for (String xsp : sp) {</span>
<span class="nc" id="L72">                    wordFrequencyMap.put(xsp, wordFrequencyMap.getOrDefault(xsp, 0) + 1);</span>
                }
            }
<span class="nc" id="L75">        }</span>
<span class="nc" id="L76">        LOGGER.info(&quot;Related word map&quot; + wordFrequencyMap);</span>
<span class="nc" id="L77">        wordFrequencyMap.remove(&quot;java&quot;);</span>
<span class="nc" id="L78">        wordFrequencyMap.remove(keyword);</span>

<span class="nc" id="L80">        System.out.println(wordFrequencyMap);</span>

<span class="nc" id="L82">        return wordFrequencyMap.toString();</span>
    }


    @GetMapping(&quot;/api/topics&quot;)
    @ResponseBody
    public String apiTopics(HttpServletRequest request) throws JsonProcessingException {
<span class="nc" id="L89">        String keyword = request.getParameter(&quot;input&quot;);</span>
<span class="nc" id="L90">        System.out.println(keyword);</span>
<span class="nc" id="L91">        Map&lt;String, Integer&gt; wordFrequencyMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L92">        List&lt;Student&gt; students = studentService.getStudents();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        for(Student student : students){</span>
<span class="nc" id="L94">            String tag = student.getTags();</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">            if(containsWord(tag,keyword)){</span>
<span class="nc" id="L96">                tag = tag.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span class="nc" id="L97">                String[] sp = tag.split(&quot;,&quot;);</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">                for(String xsp : sp){</span>
<span class="nc" id="L99">                    wordFrequencyMap.put(xsp, wordFrequencyMap.getOrDefault(xsp, 0) + 1);</span>
                }
            }
<span class="nc" id="L102">        }</span>
<span class="nc" id="L103">        LOGGER.info(&quot;Related word map&quot;+wordFrequencyMap);</span>
<span class="nc" id="L104">        wordFrequencyMap.remove(&quot;java&quot;);</span>
<span class="nc" id="L105">        wordFrequencyMap.remove(keyword);</span>
<span class="nc" id="L106">        Map&lt;String, Integer&gt; sortedMap = wordFrequencyMap.entrySet()</span>
<span class="nc" id="L107">                .stream()</span>
<span class="nc" id="L108">                .sorted((entry1, entry2) -&gt; entry2.getValue().compareTo(entry1.getValue())) // 降序排序</span>
<span class="nc" id="L109">                .limit(5)</span>
<span class="nc" id="L110">                .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, (e1, e2) -&gt; e2, HashMap::new));</span>

        //System.out.println(sortedMap);
<span class="nc" id="L113">        StringBuilder result = new StringBuilder();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        for (String key : sortedMap.keySet()) {</span>
<span class="nc" id="L115">            result.append(key).append(&quot;,&quot;);</span>
<span class="nc" id="L116">        }</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">        if (result.length() &gt; 0) {</span>
<span class="nc" id="L118">            result.deleteCharAt(result.length() - 1);</span>
        }
<span class="nc" id="L120">        System.out.println(result.toString());</span>
<span class="nc" id="L121">        LOGGER.info(&quot;Related word&quot;+result.toString());</span>

<span class="nc" id="L123">        List&lt;Map.Entry&lt;String, Integer&gt;&gt; list = new ArrayList&lt;&gt;(sortedMap.entrySet());</span>

        // 使用Collections.sort对List进行排序，传入自定义的比较器Comparator
<span class="nc" id="L126">        Collections.sort(list, new Comparator&lt;Map.Entry&lt;String, Integer&gt;&gt;() {</span>
            @Override
            public int compare(Map.Entry&lt;String, Integer&gt; o1, Map.Entry&lt;String, Integer&gt; o2) {
                // 以升序排序
<span class="nc" id="L130">                return o2.getValue().compareTo(o1.getValue());</span>
            }
        });

<span class="nc" id="L134">        ObjectMapper objectMapper = new ObjectMapper();</span>

        try {
            // 将 JSON 字符串转换为 List&lt;Map&lt;String, Integer&gt;&gt;
            //List&lt;Map&lt;String, Integer&gt;&gt; listOfMaps = objectMapper.readValue(list.toString(), ArrayList.class);

            // 提取每个字典的键
//            List&lt;String&gt; keysList = list.stream()
//                    .map(map -&gt; map.keySet().iterator().next()) // 提取键
//                    .collect(Collectors.toList());
<span class="nc" id="L144">            List&lt;String&gt; keysList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            for (Map.Entry&lt;String, Integer&gt; entry : list) {</span>
<span class="nc" id="L146">                keysList.add(entry.getKey());</span>
<span class="nc" id="L147">            }</span>
            // 输出按顺序的键列表
            //System.out.println(keysList);
<span class="nc" id="L150">            return objectMapper.writeValueAsString(keysList);</span>
<span class="nc" id="L151">        } catch (JsonProcessingException e) {</span>
<span class="nc" id="L152">            e.printStackTrace();</span>
        }
<span class="nc" id="L154">        return null;</span>
    }

    public String getMatchedWords(String keyword){
<span class="nc" id="L158">        System.out.println(keyword);</span>
<span class="nc" id="L159">        Map&lt;String, Integer&gt; wordFrequencyMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L160">        List&lt;Student&gt; students = studentService.getStudents();</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        for(Student student : students){</span>
<span class="nc" id="L162">            String tag = student.getTags();</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">            if(containsWord(tag,keyword)){</span>
<span class="nc" id="L164">                tag = tag.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span class="nc" id="L165">                String[] sp = tag.split(&quot;,&quot;);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">                for(String xsp : sp){</span>
<span class="nc" id="L167">                    wordFrequencyMap.put(xsp, wordFrequencyMap.getOrDefault(xsp, 0) + 1);</span>
                }
            }
<span class="nc" id="L170">        }</span>
<span class="nc" id="L171">        LOGGER.info(&quot;Related word map&quot;+wordFrequencyMap);</span>
<span class="nc" id="L172">        wordFrequencyMap.remove(&quot;java&quot;);</span>
<span class="nc" id="L173">        wordFrequencyMap.remove(keyword);</span>
<span class="nc" id="L174">        Map&lt;String, Integer&gt; sortedMap = wordFrequencyMap.entrySet()</span>
<span class="nc" id="L175">                .stream()</span>
<span class="nc" id="L176">                .sorted((entry1, entry2) -&gt; entry2.getValue().compareTo(entry1.getValue())) // 降序排序</span>
<span class="nc" id="L177">                .limit(5)</span>
<span class="nc" id="L178">                .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, (e1, e2) -&gt; e2, HashMap::new));</span>

        //System.out.println(sortedMap);
<span class="nc" id="L181">        StringBuilder result = new StringBuilder();</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">        for (String key : sortedMap.keySet()) {</span>
<span class="nc" id="L183">            result.append(key).append(&quot;,&quot;);</span>
<span class="nc" id="L184">        }</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (result.length() &gt; 0) {</span>
<span class="nc" id="L186">            result.deleteCharAt(result.length() - 1);</span>
        }
<span class="nc" id="L188">        System.out.println(result.toString());</span>
<span class="nc" id="L189">        LOGGER.info(&quot;Related word&quot;+result.toString());</span>
<span class="nc" id="L190">        return result.toString();</span>

    }
    public static boolean containsWord(String input, String word) {
        // 将单词转换为正则表达式，考虑单词的边界
<span class="nc" id="L195">        String regex = &quot;\\b&quot; + Pattern.quote(word) + &quot;\\b&quot;;</span>

        // 使用正则表达式进行匹配
<span class="nc" id="L198">        Pattern pattern = Pattern.compile(regex, Pattern.CASE_INSENSITIVE);</span>
<span class="nc" id="L199">        Matcher matcher = pattern.matcher(input);</span>

<span class="nc" id="L201">        return matcher.find();</span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>